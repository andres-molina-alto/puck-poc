{"version":3,"file":"static/js/530.b3dfa713.chunk.js","mappings":"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","sources":["../node_modules/@puckeditor/core/dist/Editor-NK3TZSR6.mjs"],"sourcesContent":["import {\n  PuckRichText\n} from \"./chunk-2CNEFIQP.mjs\";\nimport {\n  EditorInner,\n  LoadedRichTextMenu\n} from \"./chunk-RHVK562Z.mjs\";\nimport \"./chunk-AOEDIUVK.mjs\";\nimport \"./chunk-5V242HXR.mjs\";\nimport \"./chunk-MSZPUXZP.mjs\";\nimport \"./chunk-KOUWDQ4Q.mjs\";\nimport \"./chunk-SKJTJUWU.mjs\";\nimport {\n  useAppStore,\n  useAppStoreApi\n} from \"./chunk-UMTU6EA7.mjs\";\nimport \"./chunk-37HTE4KO.mjs\";\nimport \"./chunk-MDUBGHWF.mjs\";\nimport \"./chunk-Y2EFNT5P.mjs\";\nimport \"./chunk-PMXRXC2B.mjs\";\nimport {\n  __spreadProps,\n  __spreadValues,\n  init_react_import\n} from \"./chunk-M6W7YEVX.mjs\";\n\n// components/RichTextEditor/components/Editor.tsx\ninit_react_import();\nimport { memo, useMemo } from \"react\";\n\n// components/RichTextEditor/lib/use-synced-editor.ts\ninit_react_import();\nimport { useEditor } from \"@tiptap/react\";\nimport { useEffect, useRef } from \"react\";\nimport { useDebounce } from \"use-debounce\";\nfunction useSyncedEditor({\n  content,\n  onChange,\n  extensions,\n  editable = true,\n  onFocusChange,\n  name\n}) {\n  const [debouncedState, setDebouncedState] = useDebounce(null, 50, {\n    leading: true,\n    maxWait: 200\n  });\n  const syncingRef = useRef(false);\n  const lastSyncedRef = useRef(\"\");\n  const editTimer = useRef(null);\n  const isPending = !!editTimer.current;\n  const isFocused = useAppStore((s) => s.state.ui.field.focus === name);\n  const resetTimer = (clearOn) => {\n    if (editTimer.current) {\n      clearTimeout(editTimer.current);\n    }\n    editTimer.current = setTimeout(() => {\n      if (lastSyncedRef.current === clearOn) {\n        editTimer.current = null;\n      }\n    }, 200);\n  };\n  const appStoreApi = useAppStoreApi();\n  const editor = useEditor({\n    extensions,\n    content,\n    editable,\n    immediatelyRender: false,\n    parseOptions: { preserveWhitespace: \"full\" },\n    onUpdate: ({ editor: editor2 }) => {\n      if (syncingRef.current || !isFocused) {\n        appStoreApi.getState().setUi({ field: { focus: name } });\n        return;\n      }\n      const html = editor2.getHTML();\n      const { from, to } = editor2.state.selection;\n      setDebouncedState({ from, to, html });\n      resetTimer(html);\n      lastSyncedRef.current = html;\n    }\n  });\n  useEffect(() => {\n    if (!editor) return;\n    const handleFocus = () => {\n      onFocusChange == null ? void 0 : onFocusChange(editor);\n    };\n    editor.on(\"focus\", handleFocus);\n    return () => {\n      editor.off(\"focus\", handleFocus);\n    };\n  }, [editor, onFocusChange]);\n  useEffect(() => {\n    if (debouncedState) {\n      const { ui } = appStoreApi.getState().state;\n      onChange(debouncedState.html, {\n        field: __spreadProps(__spreadValues({}, ui.field), {\n          metadata: { from: debouncedState.from, to: debouncedState.to }\n        })\n      });\n    }\n  }, [editor, debouncedState, onChange, appStoreApi, name]);\n  useEffect(() => {\n    editor == null ? void 0 : editor.setEditable(editable);\n  }, [editor, editable]);\n  useEffect(() => {\n    var _a;\n    if (!editor) return;\n    if (isPending) {\n      return;\n    }\n    const current = editor.getHTML();\n    if (current === content) return;\n    syncingRef.current = true;\n    editor.commands.setContent(content, { emitUpdate: false });\n    const { ui } = appStoreApi.getState().state;\n    if (typeof ((_a = ui.field.metadata) == null ? void 0 : _a.from) !== \"undefined\") {\n      editor.commands.setTextSelection({\n        from: ui.field.metadata.from,\n        to: ui.field.metadata.to\n      });\n    }\n    syncingRef.current = false;\n  }, [content, editor, appStoreApi]);\n  return editor;\n}\n\n// components/RichTextEditor/components/Editor.tsx\nimport { EditorContent } from \"@tiptap/react\";\nimport { jsx } from \"react/jsx-runtime\";\nvar Editor = memo((props) => {\n  const {\n    onChange,\n    content,\n    readOnly = false,\n    field,\n    inline = false,\n    onFocus,\n    id,\n    name\n  } = props;\n  const { tiptap = {}, options } = field;\n  const { extensions = [] } = tiptap;\n  const loadedExtensions = useMemo(\n    () => [PuckRichText.configure(options), ...extensions],\n    [field, extensions]\n  );\n  const appStoreApi = useAppStoreApi();\n  const focusName = `${name}${inline ? \"::inline\" : \"\"}`;\n  const editor = useSyncedEditor({\n    content,\n    onChange,\n    extensions: loadedExtensions,\n    editable: !readOnly,\n    name: focusName,\n    onFocusChange: (editor2) => {\n      if (editor2) {\n        const s = appStoreApi.getState();\n        appStoreApi.setState({\n          currentRichText: {\n            field,\n            editor: editor2,\n            id,\n            inline\n          },\n          state: __spreadProps(__spreadValues({}, s.state), {\n            ui: __spreadProps(__spreadValues({}, s.state.ui), {\n              field: __spreadProps(__spreadValues({}, s.state.ui.field), {\n                focus: focusName\n              })\n            })\n          })\n        });\n        onFocus == null ? void 0 : onFocus(editor2);\n      }\n    }\n  });\n  const menuEditor = useAppStore((s) => {\n    var _a, _b;\n    if (!inline && ((_a = s.currentRichText) == null ? void 0 : _a.id) === id && ((_b = s.currentRichText) == null ? void 0 : _b.inlineComponentId)) {\n      return s.currentRichText.editor;\n    }\n    return editor;\n  });\n  if (!editor) return null;\n  return /* @__PURE__ */ jsx(\n    EditorInner,\n    __spreadProps(__spreadValues({}, props), {\n      editor,\n      menu: /* @__PURE__ */ jsx(\n        LoadedRichTextMenu,\n        {\n          field,\n          editor: menuEditor,\n          readOnly\n        }\n      ),\n      children: /* @__PURE__ */ jsx(EditorContent, { editor, className: \"rich-text\" })\n    })\n  );\n});\nEditor.displayName = \"Editor\";\nexport {\n  Editor\n};\n"],"names":["useSyncedEditor","_ref","content","onChange","extensions","editable","onFocusChange","name","debouncedState","setDebouncedState","useDebounce","leading","maxWait","syncingRef","useRef","lastSyncedRef","editTimer","isPending","current","isFocused","useAppStore","s","state","ui","field","focus","appStoreApi","useAppStoreApi","editor","useEditor","immediatelyRender","parseOptions","preserveWhitespace","onUpdate","_ref2","editor2","getState","setUi","html","getHTML","from","to","selection","clearOn","clearTimeout","setTimeout","useEffect","handleFocus","on","off","__spreadProps","__spreadValues","metadata","setEditable","_a","commands","setContent","emitUpdate","setTextSelection","init_react_import","Editor","memo","props","readOnly","inline","onFocus","id","tiptap","options","loadedExtensions","useMemo","PuckRichText","configure","focusName","concat","setState","currentRichText","menuEditor","_b","inlineComponentId","jsx","EditorInner","menu","LoadedRichTextMenu","children","EditorContent","className","displayName"],"sourceRoot":""}